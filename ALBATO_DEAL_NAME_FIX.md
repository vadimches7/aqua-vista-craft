# Исправление названия сделки в amoCRM

## Проблема
В amoCRM название сделки приходит как user-agent строка вместо имени клиента или правильного названия.

## Решение
Добавлены явные поля для названия сделки:
- `deal_name` - название сделки
- `lead_name` - альтернативное название (для совместимости)

## Формат названия сделки

### Для калькулятора:
```
Заявка с калькулятора — {тип проекта}
```
Например: "Заявка с калькулятора — Установка под ключ"

### Для тарифов:
```
Заявка по тарифу — {название тарифа}
```
Например: "Заявка по тарифу — Reef 240 Start"

### Для других форм:
```
Заявка с сайта — {тип формы}
```

## Настройка в Albato

В шаге "Создать сделку" в amoCRM нужно привязать поле:

**Название сделки** → `deal_name` или `lead_name`

**НЕ используйте:**
- `name` (это имя контакта)
- `page_url` 
- Любые HTTP заголовки (user-agent и т.д.)

## Проверка

После отправки формы проверьте в консоли браузера:
```
[Albato] Sending form data: {
  name: "Тест",
  phone: "89249991234",
  deal_name: "Заявка с калькулятора — Установка под ключ",
  lead_name: "Заявка с калькулятора — Установка под ключ",
  ...
}
```

Убедитесь, что `deal_name` содержит правильное название.

## Если проблема остаётся

1. Проверьте в Albato "Ловец вебхуков" - должно быть поле `deal_name`
2. В настройках связки Albato → amoCRM проверьте маппинг поля "Название сделки"
3. Убедитесь, что используется `deal_name`, а не другие поля

